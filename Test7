-- Codex UI Library (Full Demo Included)

local Codex = {}
Codex.__index = Codex

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Player = Players.LocalPlayer

-- Cleanup old UI
pcall(function()
    Player.PlayerGui:FindFirstChild("CodexUI"):Destroy()
end)

-- ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "CodexUI"
gui.ResetOnSpawn = false
gui.Parent = Player:WaitForChild("PlayerGui")

-- Main Window
local main = Instance.new("Frame")
main.Size = UDim2.new(0, 600, 0, 500)
main.Position = UDim2.new(0.5, -300, 0.5, -250)
main.BackgroundColor3 = Color3.fromRGB(18,18,18)
main.BorderSizePixel = 0
main.Parent = gui
Instance.new("UICorner", main).CornerRadius = UDim.new(0,16)

-- Accent + Top Bar
local accent = Instance.new("Frame", main)
accent.Size = UDim2.new(1,0,0,4)
accent.BackgroundColor3 = Color3.fromRGB(255,50,50)
accent.BorderSizePixel = 0

local top = Instance.new("Frame", main)
top.Size = UDim2.new(1,0,0,44)
top.Position = UDim2.new(0,0,0,4)
top.BackgroundColor3 = Color3.fromRGB(24,24,24)
top.BorderSizePixel = 0
Instance.new("UICorner", top).CornerRadius = UDim.new(0,16)

local title = Instance.new("TextLabel", top)
title.Size = UDim2.new(1,0,1,0)
title.BackgroundTransparency = 1
title.Text = "CODEX"
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextColor3 = Color3.fromRGB(255,255,255)

-- Tabs + Pages
local tabs = Instance.new("Frame", main)
tabs.Position = UDim2.new(0,10,0,54)
tabs.Size = UDim2.new(0,150,1,-64)
tabs.BackgroundTransparency = 1
local tabLayout = Instance.new("UIListLayout", tabs)
tabLayout.Padding = UDim.new(0,10)

local pages = Instance.new("Frame", main)
pages.Position = UDim2.new(0,170,0,54)
pages.Size = UDim2.new(1,-180,1,-64)
pages.BackgroundTransparency = 1

-- Dragging
do
    local dragging, dragStart, startPos
    top.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = main.Position
        end
    end)
    top.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    UIS.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            main.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- Create Tab
function Codex:CreateTab(name)
    local tabBtn = Instance.new("TextButton", tabs)
    tabBtn.Size = UDim2.new(1,0,0,44)
    tabBtn.BackgroundColor3 = Color3.fromRGB(30,30,30)
    tabBtn.Text = name
    tabBtn.Font = Enum.Font.Gotham
    tabBtn.TextSize = 14
    tabBtn.TextColor3 = Color3.fromRGB(255,255,255)
    tabBtn.BorderSizePixel = 0
    Instance.new("UICorner", tabBtn).CornerRadius = UDim.new(0,12)

    local page = Instance.new("ScrollingFrame", pages)
    page.Size = UDim2.new(1,0,1,0)
    page.BackgroundTransparency = 1
    page.ScrollBarImageTransparency = 1
    page.CanvasSize = UDim2.new(0,0,0,0)
    page.Visible = false
    local layout = Instance.new("UIListLayout", page)
    layout.Padding = UDim.new(0,10)
    layout.Name = "UIListLayout"

    local selectLine = Instance.new("Frame", tabBtn)
    selectLine.Size = UDim2.new(0,0,0,3)
    selectLine.Position = UDim2.new(0,0,1,0)
    selectLine.BackgroundColor3 = Color3.fromRGB(255,50,50)
    selectLine.BorderSizePixel = 0
    tabBtn.selectLine = selectLine

    local function selectTab()
        for _,p in ipairs(pages:GetChildren()) do
            if p:IsA("ScrollingFrame") then
                p.Visible = false
            end
        end
        page.Visible = true
        for _,tab in ipairs(tabs:GetChildren()) do
            if tab:IsA("TextButton") then
                TweenService:Create(tab.selectLine, TweenInfo.new(0.2), {Size = UDim2.new(0,0,0,3)}):Play()
            end
        end
        TweenService:Create(selectLine, TweenInfo.new(0.2), {Size = UDim2.new(1,0,0,3)}):Play()
    end
    tabBtn.MouseButton1Click:Connect(selectTab)
    if #tabs:GetChildren() == 1 then selectTab() end
    return page
end

-- Create Button
function Codex:CreateButton(tab, text, callback)
    local btn = Instance.new("TextButton", tab)
    btn.Size = UDim2.new(1,0,0,44)
    btn.BackgroundColor3 = Color3.fromRGB(35,35,35)
    btn.Text = text
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.BorderSizePixel = 0
    btn.AutoButtonColor = false
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,12)

    btn.MouseEnter:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(45,45,45)}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35,35,35)}):Play()
    end)
    btn.MouseButton1Click:Connect(function() pcall(callback) end)

    task.wait()
    tab.CanvasSize = UDim2.new(0,0,0,tab.UIListLayout.AbsoluteContentSize.Y + 10)
end

-- Create Toggle
function Codex:CreateToggle(tab, text, default, callback)
    local frame = Instance.new("Frame", tab)
    frame.Size = UDim2.new(1,0,0,40)
    frame.BackgroundTransparency = 1

    local label = Instance.new("TextLabel", frame)
    label.Size = UDim2.new(0.7,0,1,0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left

    local toggleBtn = Instance.new("TextButton", frame)
    toggleBtn.Size = UDim2.new(0,40,0,20)
    toggleBtn.Position = UDim2.new(1,-50,0,10)
    toggleBtn.BackgroundColor3 = default and Color3.fromRGB(255,50,50) or Color3.fromRGB(60,60,60)
    toggleBtn.Text = ""
    Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0,10)

    local state = default
    toggleBtn.MouseButton1Click:Connect(function()
        state = not state
        TweenService:Create(toggleBtn, TweenInfo.new(0.2), {BackgroundColor3 = state and Color3.fromRGB(255,50,50) or Color3.fromRGB(60,60,60)}):Play()
        pcall(callback, state)
    end)

    task.wait()
    tab.CanvasSize = UDim2.new(0,0,0,tab.UIListLayout.AbsoluteContentSize.Y + 10)
end

-- Create Slider
function Codex:CreateSlider(tab, text, min, max, default, callback)
    local sliderFrame = Instance.new("Frame", tab)
    sliderFrame.Size = UDim2.new(1,0,0,40)
    sliderFrame.BackgroundTransparency = 1

    local label = Instance.new("TextLabel", sliderFrame)
    label.Size = UDim2.new(0.7,0,1,0)
    label.BackgroundTransparency = 1
    label.Text = text.." : "..default
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left

    local sliderBg = Instance.new("Frame", sliderFrame)
    sliderBg.Size = UDim2.new(0.7,0,0,6)
    sliderBg.Position = UDim2.new(0.28,0,0.5,-3)
    sliderBg.BackgroundColor3 = Color3.fromRGB(60,60,60)
    sliderBg.BorderSizePixel = 0
    Instance.new("UICorner", sliderBg).CornerRadius = UDim.new(0,3)

    local sliderFill = Instance.new("Frame", sliderBg)
    sliderFill.Size = UDim2.new((default-min)/(max-min),0,1,0)
    sliderFill.BackgroundColor3 = Color3.fromRGB(255,50,50)
    sliderFill.BorderSizePixel = 0
    Instance.new("UICorner", sliderFill).CornerRadius = UDim.new(0,3)

    local dragging = false
    UIS.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 and (input.Target == sliderBg or input.Target == sliderFill) then
            dragging = true
        end
    end)
    UIS.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    UIS.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mouseX = input.Position.X - sliderBg.AbsolutePosition.X
            mouseX = math.clamp(mouseX,0,sliderBg.AbsoluteSize.X)
            sliderFill.Size = UDim2.new(mouseX/sliderBg.AbsoluteSize.X,0,1,0)
            local value = math.floor((mouseX/sliderBg.AbsoluteSize.X)*(max-min) + min)
            label.Text = text.." : "..value
            pcall(callback, value)
        end
    end)

    task.wait()
    tab.CanvasSize = UDim2.new(0,0,0,tab.UIListLayout.AbsoluteContentSize.Y + 10)
end

-- Return library
return Codex
